on: workflow_dispatch
jobs:
  test-github-cli:
    runs-on: ubuntu-latest
    permissions: write-all
    steps:
      - run: gh repo clone GMZwinge/test-github-cli2 .
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - run: git checkout -b branch
      - run: date +%s > report.txt
      - run: git add .
      # To avoid this error during `git commit`:
      #    Author identity unknown
      - run: git config --global user.email "you@example.com"
      - run: git config --global user.name "Your Name"
      - run: git commit -m dummy
      # Even with permission: write-all, this gives this error:
      #  fatal: could not read Username for 'https://github.com': No such device or address
      # https://github.com/orgs/community/discussions/26580 talks about this.
      # From abannachGrafana:
      - run: git config --global url.https://${{ secrets.PAT }}@github.com/.insteadOf https://github.com/
      - run: git push --set-upstream origin branch
      - run: gh pr create --fill
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
